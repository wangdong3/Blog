(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{430:function(s,a,n){"use strict";n.r(a);var t=n(56),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"nginx"}},[s._v("nginx")]),s._v(" "),n("blockquote",[n("p",[s._v("高性能HTTP和反向代理服务器。")])]),s._v(" "),n("h2",{attrs:{id:"前言"}},[s._v("前言")]),s._v(" "),n("h3",{attrs:{id:"反向代理"}},[s._v("反向代理")]),s._v(" "),n("p",[s._v("作为服务端的代理服务，接收客户端的请求，将请求转发内网服务器，并将服务器处理结果返回客户端。")]),s._v(" "),n("p",[s._v("对服务端透明，对客户端不透明。")]),s._v(" "),n("h3",{attrs:{id:"正向代理"}},[s._v("正向代理")]),s._v(" "),n("p",[s._v("作为客户端的代理，向目标服务器发出请求。")]),s._v(" "),n("p",[s._v("对客户端透明，对服务端不透明。")]),s._v(" "),n("h3",{attrs:{id:"选择nginx"}},[s._v("选择Nginx")]),s._v(" "),n("p",[s._v("选择使用一个服务器之前，要从以下几个方面综合考量")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("效率：快")])]),s._v(" "),n("li",[n("p",[s._v("成本：内存消耗少")])]),s._v(" "),n("li",[n("p",[s._v("是否可靠：稳定性高，宕机概率很低")])]),s._v(" "),n("li",[n("p",[s._v("是否强大：高并发连接")])]),s._v(" "),n("li",[n("p",[s._v("是否方便：开源，配置简单，支持热部署")])])]),s._v(" "),n("h2",{attrs:{id:"核心概念"}},[s._v("核心概念")]),s._v(" "),n("h3",{attrs:{id:"动静分离"}},[s._v("动静分离")]),s._v(" "),n("p",[s._v("在 "),n("code",[s._v("web")]),s._v(" 服务器架构中，将静态页面与动态页面或者静态内容接口和动态内容接口分开不同系统访问。")]),s._v(" "),n("p",[n("code",[s._v("Nginx")]),s._v("作为静态代理服务器，反向代理服务器")]),s._v(" "),n("div",{staticClass:"language-mermaid line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-mermaid"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("graph")]),s._v(" TD\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("subgraph")]),s._v(" 动态web服务器\nt"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(Tomcat等处理复杂业务的动态web服务器)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("subgraph")]),s._v(" Nginx\ng"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(作为静态web服务器)")]),s._v("\ng1"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(作为反向代理服务器)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\na"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(客户端请求)")]),s._v("\na"),n("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[n("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[s._v("--")]),n("span",{pre:!0,attrs:{class:"token label property"}},[s._v("静态文件请求")]),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")])]),s._v("g\ng"),n("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[n("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[s._v("-.")]),n("span",{pre:!0,attrs:{class:"token label property"}},[s._v("静态文件")]),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v(".->")])]),s._v("a\n\na"),n("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[n("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[s._v("--")]),n("span",{pre:!0,attrs:{class:"token label property"}},[s._v("动态请求")]),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")])]),s._v("g1\ng1"),n("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[n("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[s._v("--")]),n("span",{pre:!0,attrs:{class:"token label property"}},[s._v("转发请求")]),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")])]),s._v("t\n\nt"),n("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[n("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[s._v("-.")]),n("span",{pre:!0,attrs:{class:"token label property"}},[s._v("动态应答")]),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v(".->")])]),s._v("g1\ng1"),n("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[n("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[s._v("-.")]),n("span",{pre:!0,attrs:{class:"token label property"}},[s._v("转发动态应答")]),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v(".->")])]),s._v("a\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h3",{attrs:{id:"负载均衡"}},[s._v("负载均衡")]),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("Nginx")]),s._v("实现负载均衡，将请求转发给服务器集群")])]),s._v(" "),n("div",{staticClass:"language-mermaid line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-mermaid"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("graph")]),s._v(" LR\na"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("((客户端))")]),s._v("\na"),n("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[n("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[s._v("--")]),n("span",{pre:!0,attrs:{class:"token label property"}},[s._v("request")]),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")])]),s._v("b"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(Nginx)")]),s._v("\nb"),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v("c1"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(服务端)")]),s._v("\nb"),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(服务端)")]),s._v("\nb"),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v("c3"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(服务端)")]),s._v("\nb"),n("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[n("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[s._v("-.")]),n("span",{pre:!0,attrs:{class:"token label property"}},[s._v("response")]),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v(".->")])]),s._v("a\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h4",{attrs:{id:"负载均衡策略"}},[s._v("负载均衡策略")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("轮询：默认策略，将客户端请求轮询发给服务端")])]),s._v(" "),n("li",[n("p",[s._v("最小连接数：将请求优先分给压力最小的服务器")])]),s._v(" "),n("li",[n("p",[s._v("最快响应时间：将请求优先分给响应时间最短的服务器")])]),s._v(" "),n("li",[n("p",[s._v("客户端"),n("code",[s._v("IP")]),s._v("绑定：来自同一个"),n("code",[s._v("IP")]),s._v("的请求固定分给一台服务器")])])]),s._v(" "),n("h2",{attrs:{id:"配置相关"}},[s._v("配置相关")]),s._v(" "),n("p",[s._v("配置文件 "),n("code",[s._v("nginx.conf")])]),s._v(" "),n("h3",{attrs:{id:"主配置项"}},[s._v("主配置项")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 指定运行 Nginx 的 woker 子进程的属主和属组，其中组可以不指定\nuser  nobody;\n\n# 指定 Nginx 启动的 worker 子进程数量。\nworker_processes  1;\n\n# 指定运行 Nginx master 主进程的 pid 文件存放路径。\npid   logs/nginx.pid;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("code",[s._v("Nginx")]),s._v("进程间的关系")]),s._v(" "),n("div",{staticClass:"language-mermaid line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-mermaid"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("graph")]),s._v(" TD\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("%%master负责管理启停 ，重载配置文件，平滑升级")]),s._v("\nm"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(master进程)")]),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("---")]),s._v("w"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(worker进程)")]),s._v("\nm"),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("---")]),s._v("w1"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(worker进程)")]),s._v("\nm"),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("---")]),s._v("w2"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(worker进程)")]),s._v("\nm"),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("---")]),s._v("w3"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(worker进程)")]),s._v("\n\nw"),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("---")]),s._v("c"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(客户端HTTP请求)")]),s._v("\nw1"),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("---")]),s._v("c1"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(客户端HTTP请求)")]),s._v("\nw2"),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("---")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(客户端HTTP请求)")]),s._v("\nw3"),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("---")]),s._v("c3"),n("span",{pre:!0,attrs:{class:"token text string"}},[s._v("(客户端HTTP请求)")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h3",{attrs:{id:"块配置项"}},[s._v("块配置项")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#Nginx 服务器与用户的网络连接\nevents {\n\t# Nginx 使用何种事件驱动模型。可选值为：select、poll、kqueue、epoll、/dev/poll、eventport\n\tuse epoll; #使用epoll的IO模型\n\t\n\t# worker 子进程能够处理的最大并发连接数。\n\tworker_connections 1024; \n\t\n\t# 是否打开负载均衡互斥锁。\n\taccept_mutex on # 默认是off关闭的\n\t...\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#代理、缓存、日志定义\nhttp {\n\n\t#定义上游服务器集群，做负载用\n    upstream {\n        ...\n    }\n    \n\t#指定服务器名称（域名或IP：port）\n    server {\n        listen       80;       # 配置监听的端口\n        server_name  localhost;    # 配置的域名\n\n\t\t# 配置路径\n        location / {\n        \t# 指定静态资源目录位置\n            root /html;\n            index index.html;\n            deny "具体ip";\n            allow "具体IP";\n        }\n        error_page 500 502 503 504 /50x.html;\n        error_page 400 404 error.html;\n        ...\n    }\n\t...\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("h3",{attrs:{id:"反向代理配置"}},[s._v("反向代理配置")]),s._v(" "),n("p",[s._v("核心："),n("code",[s._v("upstream")]),s._v("、"),n("code",[s._v("proxy_pass")])]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 设置上游服务名称，可以proxy_pass指令中使用的代理服务器，默认的负载均衡是轮询\nupstream "servername" {\n\t# 定义上游服务器地址\n\tserver "ip:port weight=1 max_fails=2 fail_timeout=10s";\n\tserver "ip:port weight=2 max_fails=2 fail_timeout=10s";\n\tserver "ip:port weight=3 max_fails=2 fail_timeout=10s";\n\t\n\t# 限制每个 worker 子进程与上游服务器空闲长连接的最大数量。\n\tkeepalive 32;\n\t# 单个长连接可以处理的最多 HTTP 请求个数。\n  \tkeepalive_requests 50;\n  \t\n  \t# 空闲长连接的最长保持时间。\n \tkeepalive_timeout 30s;\n\t......\n}\n\nupstream "servername" {\n\tip_hash;\n\tserver "ip:port";\n\tserver "ip:port";\n\tserver "ip:port down";\n\t......\n}\n\nserver {\n\tlisten "port";\n\tserver_name "server_name";\n\t\n\tlocation /\n\t{\n\t\t# 用于配置代理服务器\n\t\tproxy_pass http://"servername"；\n\t\tproxy_set_header Host "server_name"\n\t}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("h4",{attrs:{id:"反向代理配置示例"}},[s._v("反向代理配置示例")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("http {    \n\tupstream demo {\n\t\t# 作为上游服务器\n\t\tserver localhost:8085 weight=1;    \n\t\tkeepalive 32;\n         keepalive_requests 80;\n         keepalive_timeout 20s;\n\t}\n\t\n    server {\n        listen       80;\n        server_name  localhost;\n\n        location /proxy {\n        \troot   html;\n        \tindex  index.html index.htm;\n\t    \tproxy_pass http://demo/proxy;\n        }\n    }\n}\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[s._v("访问"),n("code",[s._v("http://demo/proxy")]),s._v("代理即可转发到后台"),n("code",[s._v("localhost:8085")]),s._v("服务")]),s._v(" "),n("h4",{attrs:{id:"负载均衡配置示例"}},[s._v("负载均衡配置示例")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream demo_server {\n\t# ip_hash; \n\t# least_conn;\n\t# hash $request_uri; #使用 request_uri 变量作为 hash 的 key 值\n    server localhost:8020;\n    server localhost:8030;\n    server localhost:8040;\n}\n\nserver {\n    listen 80;\n    server_name localhost;\n  \n    location /balance/ {\n  \t  proxy_pass http://demo_server;\n    }\n}\n\nserver{\n    listen 8020;\n    location / {\n  \t  return 200 'return 8020 \\n';\n    }\n}\n\nserver{\n    listen 8030;\n    location / {\n  \t  return 200 'return 8030 \\n';\n    }\n}\n\nserver{\n    listen 8040;\n    location / {\n  \t  return 200 'return 8040 \\n';\n    }\n}\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("p",[s._v("访问"),n("code",[s._v("http://demo_server/balance")]),s._v("，请求将会分发到上游三个服务器")])])}),[],!1,null,null,null);a.default=e.exports}}]);