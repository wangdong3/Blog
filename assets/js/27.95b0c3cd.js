(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{446:function(t,s,a){"use strict";a.r(s);var n=a(56),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"elasticsearch应用"}},[a("code",[t._v("ElasticSearch应用")])]),t._v(" "),a("blockquote",[a("p",[t._v("当前业务查询有一定的实时性要求，但是目前查询较为缓慢；")]),t._v(" "),a("p",[t._v("当前业务查询使用数据库进行查询，数据库表数据量较大，这种大数据量的查询比较耗时；")]),t._v(" "),a("p",[t._v("那么，如何优化当前的业务，达到快速查询的目的；")]),t._v(" "),a("p",[t._v("目前行业内使用es搜索引擎可满足业务需要")])]),t._v(" "),a("p",[t._v("如何使用--》")]),t._v(" "),a("p",[t._v("表字段信息如何维护？")]),t._v(" "),a("p",[t._v("创建索引文件、"),a("code",[t._v("mapping")]),t._v("文件维护字段信息；")]),t._v(" "),a("p",[a("strong",[t._v("创建索引：")])]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[t._v("{\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t"settings"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t"index"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t"number_of_shards"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"5", //分片数')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t"number_of_replicas"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"1" //副本数')]),t._v("\n\t\t}\n\t}\n}\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[a("strong",[a("code",[t._v("mapping")]),t._v("文件模板：")])]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[t._v("{\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t"mappings"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("\t{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t"_all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t"norms"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"false", //设置不参与搜索结果打分')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t"enabled"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"false" //_all字段会增加索引时间和索引长度')]),t._v("\n\t\t},\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t"_source"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t"enabled"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"true"//原始文档')]),t._v("\n\t\t},\n\t\t//true：动态映射，动态添加新的字段\n\t\t//false：静态映射，忽略新的字段\n\t\t//strict：严格模式，如果遇到新的字段会抛出异常\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t"dynamic"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"strict",')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t"properties"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t"column1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t\t"type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"keyword"//存储数据的时候建立索引，但不分词')]),t._v("\n\t\t\t},\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t"column2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t\t"type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"date"')]),t._v("\n\t\t\t},\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t"column3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t\t"type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"text"//存储数据的时候建立索引，同时分词')]),t._v("\n\t\t\t},\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t"column4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t\t"type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"text",')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('\t\t\t\t"index"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"false" //不参与搜索')]),t._v("\n\t\t\t}\n\t\t}\n\t}\n}\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br")])]),a("p",[a("strong",[t._v("数据写入")])]),t._v(" "),a("p",[t._v("（1）增量写数据：新增；")]),t._v(" "),a("p",[t._v("（2）删除数据，根据id删除；")]),t._v(" "),a("p",[t._v("（3）部分更新；")]),t._v(" "),a("p",[a("strong",[t._v("疑问")]),t._v("：如果有字段信息变化，如何同步？")]),t._v(" "),a("p",[t._v("已有的字段，如果已经有数据写入，不支持修改其数据类型，如果要修改，需要重建索引；\n新增字段，没有影响；")]),t._v(" "),a("p",[a("strong",[t._v("重建索引")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("\t根据现有的索引别名，创建新的临时索引别名-》创建新的索引\n\t-》往新的索引里面写数据\n\t-》索引替换，将索引别名加到新索引上，并删除老索引\n")])])]),a("p",[a("strong",[t._v("然后呢，重建索引如何处理历史数据？")])]),t._v(" "),a("blockquote",[a("p",[t._v("全量同步+增量同步")])]),t._v(" "),a("p",[t._v("（1）历史全量数据")]),t._v(" "),a("p",[t._v("处理方式：全量数据进行分页多线程异步处理；")]),t._v(" "),a("p",[t._v("（2）查询一分钟前到现在有无增量数据，有则处理")]),t._v(" "),a("p",[a("strong",[t._v("数据存储：")])]),t._v(" "),a("p",[a("strong",[t._v("索引分片")]),t._v("：根据数据量做分片")]),t._v(" "),a("p",[a("strong",[t._v("如何检索数据？")])]),t._v(" "),a("p",[t._v("构建查询字段对象")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"column1"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"column2"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"column3"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8715900737400193117"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8715900737400193118"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"column4"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"column5"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6979838166774483893"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br")])]),a("p",[t._v("查询方式：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("match：分词匹配")])]),t._v(" "),a("li",[a("p",[t._v("term：全词匹配，")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);