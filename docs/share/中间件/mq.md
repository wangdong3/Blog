# MQ

## MQ

## 为什么使用MQ

1.服务之间的解耦

2.异步的场景

3.高并发下削峰

优点：吞吐量高

## Mq的缺点

1.服务一旦挂了，业务流程就走不完，总结来说就是服务可用性降低
2.系统复杂性增加，需要考虑一致性问题，消息的重复消费，消息可靠传输

## 消息队列高可用

集群namesvr broker

## 如何保证消息不重复消费

消息消费完，会发送确认信息，消息显示consumed_success.
意外的情况，消息消费了，但是MQ刚好重启，消息没有消费成功的状态，就会再被消费一次。消费者保证，消息的唯一性。

## 消息可靠性传输

1.生产者生产消息，可能由于网络问题，没有发送到MQ，程序会抛异常，重试机制

2.MQ的问题，服务意外挂掉 ，持久化机制，在重启后将持久化数据加载到内存

3.消费者将消息弄丢，确认机制自动关闭改为手动，只有当消息消费完成，才发送确认ack