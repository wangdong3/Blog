## kafka 


### 为何使用kafka 

吞吐量大，速度快

- 磁盘顺序读

kafka的消息是顺序写到磁盘文件的末尾，以此能提升写入性能。topic的每个分区都是一个文件，收到消息，kafka会把消息插入到文件的末尾。
每个消费者对其订阅的topic都有一个offset来表示读取到了第几条数据。

- 页缓存

利用操作系统本身的page cache来优化读写性能，kafka的读写基于内存，速度快

- 零拷贝

- 分区分段+索引

kafka 的消息按topic分类存放，一个topic的消息又是可以存放到多个partition，每个分区对应一个broker节点，这个符合分布式系统的设计思想。
每个分区又会分段，消息实际上存放在各个分区的segment上，每次文件操作就是操作这个segment，为了进一步的优化，kafka为每个分段文件建立一个索引文件。、
这种设计提高了读取速率，同时也提高数据操作的并行度。

- 批量读写

写入消息时，启用批次写入，这样可以避免在网络重频繁传输单个消息带来的延迟和带宽消耗

- 批量压缩

减少网络io损耗

### kafka与其他消息中间件相比，优劣势

- 吞吐量高。tps达到百万

- 单机支持的队列数不能过多

- 不支持消息查询

- 消息回溯

- 不支持broker端类似tag的消息过滤
