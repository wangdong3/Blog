# Redis  

## Redis是什么  

key-value内存数据库

## Redis使用场景  

- 缓存，session缓存
- 消息队列
- 分布式锁

## Redis支持哪些数据结构
- String  
- list  
- hash  
- set  
- sortedset    

## Redis分布式锁  
- setnx  expire  

  setnx争抢锁，抢到之后用expire给锁加一个过期时间，防止锁忘记释放

  在释放锁之前，当前进程crash或重启，会怎样？把setnx和expire合成一条指令来使用

## 实现异步队列  

用List结构作为队列，rpush生产消息，当lpop没有消息时，sleep一会再重试

## 同步机制 

主节点的操作记录到内存buffer，rdb文件全量同步到复制节点，复制节点接收之后，将rdb镜像加载到内存，加载完成后，通知主节点将修改的操作记录同步到复制节点进行重放；

## 持久化  
- RDB   快照
- AOF   保存命令重新执行

## 常见问题  
- 缓存雪崩  大量缓存失效，请求转到数据库，造成数据库的压力；设置失效时间点均匀分布，避免雪崩；在时间上加一个随机值，使得过期时间分散；
- 缓存穿透   命中率； 缓存未命中，查询数据库空；设置默认值放到缓存里，这样就不会继续访问数据库
- 实现消息队列，队列满了怎么办，消费不完怎么办？

## 淘汰策略 

1. 设置过期中最近最少使用
2. 设置过期中将要过期的
3. 设置过期中任意数
4. 最近最少使用
5. 任意